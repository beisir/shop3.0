webpackJsonp([10],{86:function(e,t,a){function n(e){var t=this,i=a(47),l=new i;$.extend(!0,t,{listener:{},dialogEntity:null,regionEntity:null,level:1,relate:0,appendModuleCallback:null,rendedCallback:null,regionModuleMappingEntity:l},{levelList:l.levelList,relateList:l.relateList,moduleList:l.moduleList},e||{}),n.prototype.init.call(t)}n.prototype.init=function(){var e=this,t=(arguments.callee,e.regionEntity.pageEntity.cache["module-setting-html"]),a=e.getHTMLDeferred(),n=e.loadMustacheDeferred();e.initData(),$.when(a,n).done(function(){var a=(Array.isArray(arguments[0])?arguments[0][0]:arguments[0])||"";0!==$.trim(a).length&&(t["page.module.selector"]=a),e.level=e.levelList[0].val,a=mustache.render(a,{levelList:e.levelList,relateList:e.relateList,moduleList:e.moduleList,isCurrentLevel:function(){return this.val===e.level?"ddCur":""},isCurrentRelate:function(){return this.val===e.relate?"addCur":""},setDataEntity:function(){return JSON.stringify(this)},isLimitMaximum:function(){return this.limit_maximum},isLimitScope:function(){return this.limit_scope},isLimitAuthority:function(){return this.limit_authority},isLimitSimulatedLogin:function(){return this.limit_simulatedlogin},isCancellable:function(){return this.cancellable}}),e.dialogEntity=dialog({fixed:!0,content:a,title:"\u6dfb\u52a0\u6a21\u5757"}).showModal(),$(e.dialogEntity.node).find('[i="body"]').css({padding:"0px"}),e.bindEvent(),e.render(),e.rendedCallback&&e.rendedCallback.call(e),e.addEventListener("onModuleRemoveSuccess",function(t,a){e.refreshModuleState(t,a)}),e.addEventListener("onModuleAppendSuccess",function(t,a){e.refreshModuleState(t,a)})}).fail(function(){dialog({fixed:!0,title:"\u63d0\u793a",content:"\u83b7\u53d6HTML\u5931\u8d25",cancelValue:"\u53d6\u6d88",cancel:function(){this.close().remove()},okValue:"\u786e\u5b9a",ok:function(){this.close().remove()}}).showModal()})},n.prototype.initData=function(){var e=this,t={},a={};e.moduleList=e.regionModuleMappingEntity.analyticPageModuleData(e.regionEntity.pageEntity,e.regionEntity),$.each(e.moduleList,function(e,n){n.limit_scope&&(t[n.relate]?t[n.relate].push(n):t[n.relate]=[n],a[n.level]?a[n.level].push(n):a[n.level]=[n])}),$.each(e.relateList,function(a,n){$.extend(!0,n,{modules:(t[n.val]||[]).slice(0)}),e.relateList[0].modules=e.relateList[0].modules.concat((t[n.val]||[]).slice(0))}),e.levelList=e.levelList.filter(function(e){return!!(a[e.val]||[]).length})},n.prototype.bindEvent=function(){var e=this,t=$(e.dialogEntity.node),a=t.find("[data-btn-level]"),n=t.find("[data-btn-relate]"),i=t.find("[data-btn-close]"),l=t.find('[data-btn-act="append"]'),r=t.find('[data-btn-act="cancel"]');i.click(function(t){e.dialogEntity.remove()}),n.each(function(e,t){var a=$(t);a.data("data-btn-val",a.attr("data-btn-val"))}).click(function(t){var a=$(this);a.addClass("addCur").siblings().removeClass("addCur"),e.relate=Number(a.data("data-btn-val")||0),e.render()}),a.each(function(e,t){var a=$(t);a.data("data-btn-val",a.attr("data-btn-val"))}).click(function(t){var a=$(this);a.addClass("ddCur").siblings().removeClass("ddCur"),e.level=Number(a.data("data-btn-val")||0),e.render(),2!==e.level||e.regionEntity.pageEntity.ismmt||a.data("warned")||(a.data("warned",!0),dialog({fixed:!0,title:"\u63d0\u793a",content:"\u9ad8\u7ea7\u6a21\u5757\u4e3a\u6536\u8d39\u7528\u6237\u4e13\u4eab\uff0c\u5347\u7ea7\u4e3a\u4e70\u5356\u901a\u6536\u8d39\u7528\u6237\u540e\u53ef\u6dfb\u52a0\u3002",okValue:"\u786e\u5b9a",ok:function(){this.remove()}}).showModal())}),t.find("[data-entity]").each(function(e,t){var a=$(t),n=a.attr("data-entity");try{n=$.parseJSON(a.attr("data-entity"))}catch(i){}a.data("data-entity",n)}),l.click(function(t){e.appendModule($(this))}),r.click(function(t){e.removeModule($(this))})},n.prototype.removeModule=function(e){var t=this,a=e.parent(),n=a.data("data-entity")||{};arguments.callee;n.cancellable&&$.each(t.regionEntity.moduleList,function(e,i){if(i.identifier===n.identifier)return t.regionEntity.removeModule(i,function(e){e.state&&t.__dispatchEvent("onModuleRemoveSuccess",a,n)}),!1})},n.prototype.appendModule=function(e){var t=this,a=e.parent(),n=a.data("data-entity")||{};arguments.callee;if(n.enabled){var i=dialog({content:'<span class="ui-dialog-loading">\u52a0\u8f7d\u4e2d..</span>'}).showModal(),l=$.ajax({url:"/detail/turbine/template/shop2016,editmodule.html",type:"GET",dataType:"html",data:{t:Math.random(),operatetype:1,operatedata:JSON.stringify({modulemark:n.identifier,username:t.regionEntity.pageEntity.username,regionmark:t.regionEntity.identifier,templateid:pageEntity.template.id,pagetype:pageEntity.pagetype,moduleid:0,data:{}}),username:t.regionEntity.pageEntity.username}});l.done(function(e){var i=$($.trim(e)),l=i.attr("data-error")||"";if(l.length)return void dialog({fixed:!0,title:"\u63d0\u793a",content:decodeURIComponent(l),cancelValue:"\u53d6\u6d88",cancel:function(){this.close().remove()},okValue:"\u786e\u5b9a",ok:function(){this.remove()}}).showModal();try{t.appendModuleCallback&&t.appendModuleCallback($($.trim(e)))}catch(r){}t.__dispatchEvent("onModuleAppendSuccess",a,n)}).fail(function(){dialog({fixed:!0,title:"\u63d0\u793a",content:"\u6dfb\u52a0\u6a21\u5757\u5931\u8d25",cancelValue:"\u53d6\u6d88",cancel:function(){this.close().remove()},okValue:"\u786e\u5b9a",ok:function(){this.remove()}}).showModal()}).always(function(){i.remove()})}},n.prototype.refreshModuleState=function(e,t){var a=this,n=e.find("[data-desc-wrap]"),i=e.find('[data-btn-act="append"]'),l=e.find('[data-btn-act="cancel"]');a.initData(),$.each(a.moduleList,function(a,i){if(i.identifier===t.identifier)return t=i,e.data("data-entity",t),n.text(t.description),!1}),t.cancellable?(l.show(),i.hide()):(l.hide(),i.show()),t.enabled?i.removeAttr("disabled").removeClass("disabled"):i.attr("disabled",!0).addClass("disabled")},n.prototype.render=function(){var e=this,t=(e.level,e.relate,$(e.dialogEntity.node)),a=t.find("[data-module-wrap]"),n=t.find("[data-module-relate-wrap]");n.children().each(function(t,a){var i=$(a),l=i.data("data-entity"),r=!1,o=[];if(0===t)return i.show(),!0;for(var d=0;d<e.relateList.length;d++)if(e.relateList[d].val===l.val){o=e.relateList[d].modules||[];break}for(var s=0;s<o.length;s++)if(o[s].enabled&&o[s].level===e.level&&(!l.val||o[s].relate===l.val)){r=!0;break}r?i.show():i.hide(),e.relate!==l.val||r||(n.children().first().addClass("addCur").siblings().removeClass("addCur"),e.relate=0)}),a.children().each(function(t,a){var n=$(a),i=n.data("data-entity");i.level!==e.level||e.relate&&i.relate!==e.relate?n.hide():n.show()})},n.prototype.getHTMLDeferred=function(){var e=this,t=e.regionEntity.pageEntity.cache["module-setting-html"];if(t&&t["page.module.selector"]){var a=$.Deferred();return a.resolve(t["page.module.selector"]),a}return $.ajax({url:"/detail/turbine/action/GetModuleEditBoxAction/eventsubmit_doGet/doGet?filename=page.module.selector",type:"GET",dataType:"jsonp"})},n.prototype.loadMustacheDeferred=function(){var e=$.Deferred();return a.e(3,function(t){a(51),e.resolve()}),e},n.prototype.__getEventListener=function(e){var t=this;return t.listener[e]=t.listener[e]?t.listener[e]:[],t.listener[e]},n.prototype.__dispatchEvent=function(){for(var e=this,t=Array.prototype.shift.call(arguments),a=e.__getEventListener(t),n=0;n<a.length;n++)try{a[n].apply(e,arguments)}catch(i){}},n.prototype.removeEventListener=function(e,t){for(var a=this,n=a.__getEventListener(e),i=0;i<n.length;i++)t===n[i]&&n.splice(i--,1)},n.prototype.addEventListener=function(e,t){var a=this,n=[],i=e.split(",");$.each(i,function(e,i){return!$.trim(i).length||(n=a.__getEventListener(i),void n.push(t))})},e.exports=n}});